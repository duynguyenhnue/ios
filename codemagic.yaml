workflows:
  ios-build:
    name: iOS build
    environment:
      xcode: latest
      cocoapods: default
      vars:
        GITHUB_USER: ${{github.username}}
        GITHUB_TOKEN: ${{github.token}}
    triggering:
      events:
        - push
        - pull_request
    scripts:
      - name: Check for Gemfile
        script: |
          if [ ! -f Gemfile ]; then
            echo "Error: Gemfile not found!"
            exit 1
          fi
      - name: Install dependencies
        script: |
          gem install bundler
          bundle install
          cd ios
          bundle exec pod install
      - name: Build iOS app
        script: xcodebuild -workspace ios/Runner.xcworkspace -scheme Runner -sdk iphoneos -configuration Release archive -archivePath $CM_BUILD_DIR/build/Runner.xcarchive
      - name: Export IPA
        script: xcodebuild -exportArchive -archivePath $CM_BUILD_DIR/build/Runner.xcarchive -exportOptionsPlist ios/ExportOptions.plist -exportPath $CM_BUILD_DIR/build/Runner.ipa
    artifacts:
      - $CM_BUILD_DIR/build/Runner.ipa
    publishing:
      email:
        recipients:
          - your-email@example.com
